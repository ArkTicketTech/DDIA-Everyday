主节点与锁

-   系统范围内只有一个实例的场景
    -   只允许一个节点作为分区的主节点，防止脑裂
    -   只允许一个事务或客户端持有特定资源的锁，防止数据破坏
    -   只允许一个用户使用特定的用户名
-   租约到期，但是自认为有效
    -   持有租约的客户端A被暂停直到租约到期
    -   B客户端获得了文件的锁租约，并开始写文件
    -   A客户端恢复，仍然认为合法持有锁并写入文件



Fencing令牌

-   确保过期的“唯一的那个”节点不能影响其他正常部分、
-   在授予锁或租约时，会同时返回fencing令牌，每次授予都会递增；客户端每次写入都要携带fencing令牌
-   客户端A获得锁和令牌33，然后暂停；客户端B获得锁和令牌34，写入成功；客户端A恢复，尝试写入，但是记录中有令牌34，大于令牌33，所以拒绝写入



拜占庭故障

-   fencing令牌可以检测阻止无意的误操作，但是无法阻止节点故意破坏，如伪造令牌
-   节点存在“撒谎”的情况。如，节点没有收到消息，但是却对外声称收到了
-   在不信任的环境中需要达成共识的问题也被称为拜占庭将军问题
    -   两将军问题
        -   假定两名将军需要就计划达成一致，在两个不同的地点建立了营地，只能通过信使沟通，而信使在传递消息时可能会出现延迟或丢失
    -   拜占庭将军问题
        -   有n为将军需要达成共识，并存在一些叛徒试图阻扰达成共识，大多数将军都是忠诚的，发出真实信息，但是叛徒通过发送虚假或不真实的信息来欺骗别人，同时隐藏自己
-   如果某个系统即使发生部分节点故障，不遵从协议，恶意攻击，干扰网络，仍可以继续运行，则称为拜占庭式容错系统
    -   飞行控制系统
    -   比特币



Pp. 283-289