# 第九章

### 什么是共识？

让所有节点在**某件事情**上达成一致，这是非常困难的，因为分布式系统普遍存在以下问题：

1. 网络传输导致数据传输乱序、丢包、延迟
2. 时钟无法一致
3. 节点的不稳定性

### 什么是共识协议？

共识协议的作用有点像数据库中的事务，它为上层的应用提供了抽象和保证，使得应用层不需要去关心原子性、隔离性、持久性这些问题。而共识协议也就为上层应用屏蔽了分布式系统中常存在的问题，应用层只需要知道我的请求得到了容错性的保证。

如果一个分布式系统实现了某种共识协议，那么意味着该系统能够达成一致，但是这个一致是有不同级别的，不同的共识协议能够实现的级别也不一样。

## 一致性保证

大多数多副本的数据库提供的都是最终一致性的保证，因为他们实现的大部分是Raft、Paxos等最终一致性的共识协议。

最终一致性的另一个名字可以叫做收敛性，也就是所有副本的状态，只要时间够长，最终都会收敛到一致的状态，但是这个时间无法得到保证，因此对于最终一致性系统的使用者来说，需要注意。

## 线性一致性

最终一致性会导致多个副本读取不一致的问题，因为多副本之间达到一致需要时间。

在一个提供线性一致性的系统中，只要某个客户端成功的进行了写入某值，其他所有客户端都可以在数据库中读到该值。

<img src="https://wtsclwq.oss-cn-beijing.aliyuncs.com/ch09-fig01.png" alt="Untitled" style="zoom:50%;" />

