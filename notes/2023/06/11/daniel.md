分区和二级索引

如果涉及到二级索引，情况就变得更加复杂了。二级索引通常不能唯一地标识记录，它们无法完美地映射到分区。

按文档分区二级索引
每个分区维护自己的二级索引，仅覆盖该分区中的文档（本地索引）。

您需要将查询发送到所有分区，并合并所有返回的结果（散射/聚集）。这容易导致尾延迟放大，并且在MongoDB、Riak、Cassandra、Elasticsearch、SolrCloud和VoltDB中被广泛使用。

按术语分区二级索引
我们构建一个覆盖所有分区数据的全局索引。全局索引也必须进行分区，以避免成为瓶颈。

它被称为术语分区，因为我们要查找的术语决定了索引的分区。

对于范围扫描，按术语进行分区可能很有用，而按术语的哈希进行分区可以获得更均匀的负载分布。

优点在于它可以使读取更高效：客户端只需要向包含所需术语的分区发出请求，而无需在所有分区上进行散射/聚集。全局索引的缺点是写入速度较慢且复杂。

