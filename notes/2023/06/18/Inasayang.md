实现快照级别隔离

-   使用写锁防止脏写
-   读取不需要加锁
-   `MVCC`（`Multi-Version Concurrency Control` 多版本并发控制）
    -   多个正在进行的事务可能会在不同的时间点查看数据库状态，所以数据库保存了对象的多个不同提交版本
    -   在读提交级别下，对每个不同的查询单独创建快照；而快照隔离级别则是使用一个快照运行整个事务



一致性快照的可见性规则

-   每个事务开始时，找出尚未提交或中止的事务，并忽略这些事务完成的部分写入
-   所有中止事务的修改不可见
-   较晚事务ID不可见
-   数据对象对事务可见的两个条件
    -   事务开始时，创建该对象的事务已完成提交
    -   对象有或没有被标记删除，但是删除事务还没提交



索引和快照级别隔离

-   把同一个对象的不同版本放在一个内存页面上（PostgreSQL）
-   追加式的B-Tree（CouchDB，Datomic和LMDB）



跟新丢失

-   两个事务对同一个对象进行修改操作，第二个写操作不包括第一个事务修改后的值，导致第一个事务的修改值可能会丢失



Pp. 226-230