## 多主复制的使用场景

### 1 多数据中心场景

![Screenshot 2023-05-23 at 10.37.27.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1a9e5189-4cc5-40f4-b88d-c8b90c94aa38/Screenshot_2023-05-23_at_10.37.27.png)

**在多数据中心场景单主复制和多主复制比较**

- *性能方面*
单领导者配置需要将每个写操作通过互联网发送到领导者所在的数据中心，这可能会增加写操作的延迟，并可能违反创建多个数据中心的初衷。
    
    在多主复制配置中，可以在本地数据中心处理每个写操作，并异步地复制到其他数据中心，因此，跨数据中心的网络延迟对用户来说是隐藏的，这意味着感知性能可能会更好。
    
- *数据中心故障容错*
在单领导者配置中，如果具有领导者的数据中心失败，故障转移将另一个数据中心的追随者提升为领导者。
    
    在多领导者配置中，每个数据中心可以继续独立运行，而复制会在失败的数据中心恢复时重新开始。
    
- *网络问题容错*
数据中心之间的流量通常经过互联网，没有本地网络可靠。单领导者配置对这种数据中心间链接的问题非常敏感，因为写操作是同步进行的。而具有异步复制的多领导者配置通常可以更好地容忍网络问题：暂时的网络中断不会阻止写操作的处理。
- *冲突解决*
多领导者复制的一个大缺点是，同一数据可能会在两个不同的数据中心中同时被修改，这些写操作冲突必须得到解决。
- *实现方式*
一些数据库默认支持多领导者配置，但通常也可以使用外部工具来实现，例如MySQL的Tungsten Replicator，PostgreSQL的BDR和Oracle的GoldenGate。
- *配置问题*
由于多领导者复制在许多数据库中是一种后期添加的功能，因此通常存在微妙的配置陷阱和与其他数据库功能的意外交互。例如，自增键、触发器和完整性约束可能会出现问题。因此，多领导者复制通常被认为是危险的领域，如果可能的话应该避免使用。

### 2 处理离线客户端的请求场景

如果您有一个需要在断开与互联网的连接时依然能够继续工作的应用程序，那么多主复制就是合适的选择。例如，手机、笔记本电脑在离线时进行任何更改，需要在设备下次联网时将其与服务器和其他设备同步。

在这种情况下，每个设备都有一个本地数据库，充当领导者（接受写入请求），并且在所有设备上的日历的副本之间存在异步的多主复制过程（同步）。复制延迟可能是几个小时甚至几天，这取决于何时有可用的互联网服务。

从架构的角度来看，这种设置本质上与数据中心之间的多主复制相同，且达到了极致：每个设备都是一个“数据中心”，只是它们之间的网络连接极不可靠。

### 3 实时协同编辑场景

实时协同编辑应用程序允许多人同时编辑文档，例如Etherpad和Google Docs。其与离线编辑用例有很多共同之处，需要异步复制到服务器和其他用户的本地副本。如果要保证没有编辑冲突，应用程序必须在用户编辑文档之前获取文档锁定。为了更快的协作，可以将更改单元设置得非常小（例如单个按键），并避免锁定。这种方法允许多个用户同时编辑，但也带来了多个领导者复制的所有挑战，包括需要冲突解决。
