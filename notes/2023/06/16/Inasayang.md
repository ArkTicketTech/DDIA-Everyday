单对象与多对象事务操作

单对象写入

-   单对象层面提供原子性和隔离性
    -   日志恢复
    -   加锁
    -   原子操作



多对象事务的必要性

-   许多分布式数据存储系统不支持多对象事务？
    -   出现跨分区，难以正确实现
    -   高可用和高性能场景下有负面影响
-   要求写入多个对象并进行协调
    -   关系模型（外键）图模型（顶点和边），保证引用总是最新的，正确的
    -   文档模型，缺少join支持的文档数据库一次更新多个文档
    -   有二级索引的数据库，需要跟新索引，因为索引是不同的数据库对象



处理错误和中止

-   无主中，如果遇到“尽力而为”（什么场景是尽力而为，没说）的情况，可能不会撤销。需要应用层来解决
-   重试中止的缺陷
    -   事务执行成功，但是响应消息由于网络传输导致客户端认为是失败的；会导致重试重复执行，需要额外的应用级重复数据删除机制
    -   错误由于系统超负载导致，重试只会变得更糟；设置重试次数上限
    -   临时性故障和永久性故障
    -   事务产生的副作用（如跟新操作附带发送邮件，不需要每次重试都发送邮件）；使用两阶段提交
    -   客户端重试过程发生重试失败



Pp. 217-221