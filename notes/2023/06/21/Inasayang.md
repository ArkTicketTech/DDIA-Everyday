两阶段加锁（`two-phase locking，2PL`）

-   锁的强制性更高
-   多个事务可以同时读同一个对象，只要出现写，修改，删除，则必须加锁（读写锁？）
-   不会出现读到旧值的情况
-   可以防止更新丢失和写倾斜



实现两阶段加锁

-   数据库中的每个对象都有一个读写锁来隔离读写操作（锁处于共享模式或独占模式）
-   和读写锁操作一样，略
-   会自动检测死锁情况，并中止其中一个



两阶段加锁的性能

-   比其他弱隔离级别低
-   降低了事务并发性
-   如果一个事务要等待另一个事务，则等待的时间几乎没有上限
-   有延迟队列，访问延迟具有不确定性
-   如果出现死锁，则应用层必须重试



谓词锁

-   不属于某个对象
-   作用于满足某些搜索条件的所有查询对象
-   保护数据库中尚不存在但可能马上写入的对象的幻读
-   结合两阶段加锁和谓词锁，可以防止所有形式的写倾斜和其他竞争条件





索引区间锁

-   谓词锁性能不佳
-   使用2PL的数据库大都使用索引区间锁（`next-key locking`）
-   将保护对象扩大化
-   如果没有合适的索引，则可以回退到对整个表施加共享锁，但是影响性能



Pp. 242-246