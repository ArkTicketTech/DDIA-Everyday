线性化的依赖条件

加锁与主节点选举

-   选举新的主节点通常使用锁
    -   锁必须满足可线性化：所有节点都必须同意某个节点持有锁
-   提供协调者服务的系统，如，zookeeper，etcd等来实现分布式锁
    -   支持容错的共识算法确保可线性化



约束与唯一性保证

-   硬性的唯一性约束：如，主键的约束，需要线性化保证；外键和属性约束，不要求线性化
-   跨通道的事件依赖



实现线性化系统

-   复制方案

    -   主从复制（部分支持可线性化）
    -   共识算法（可线性化）
    -   多主复制（不可线性化）
    -   无主复制（可能不可线性化）

    

线性化的代价

-   CAP理论
    -   只要有不可靠的网络，都会发生违背线性化的风险
    -   如果应用要求线性化，必须等待网络恢复，或直接返回错误
    -   如果应用不要求，每个副本独立处理请求，网络恢复时，结果不符合线性化
    -   CAP有时也代表一致性，可用性，分区容错性，系统只能支持其中两个特性
    -   CAP已被更精确的研究成果所取代[242]



可线性化与网络延迟

-   现代多核CPU上的内存是非线性化的（除非使用了内存屏障和`fence`指令）
    -   每个CPU核都有自己的cache和寄存器
    -   内存访问首先进入cache系统，修改异步刷新到主存。
    -   异步刷新会导致出现多个数据副本（一个在贮存，另外几个在不同级别的cache中），无法保证线性化
-   许多系统不支持线性化是为了提高性能



Pp. 311-319