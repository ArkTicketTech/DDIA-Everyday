# 协调者失效
阶段1中任何提交或中止请求失败，协调者将无条件重试。但如果协调者失效了，又该如何？
阶段1协调者在发送准备请求之前失败，参与者可以安全地中止事务；但是一旦参与者收到了准备请求并投了「是」，就不能单方面放弃，必须等待协调者回答事务是否已经提交和中止。如果此时协调者崩溃或者网络故障，参与者什么也做不了只能等待。参与者的这种事务状态称为「存疑的」或是「不确定的」。
阶段2：如果协调者在给其他节点发送了确认提交请求，但给其他某一个参与者节点发送提交确认请求前崩溃了，那未发送的这个参与者不知道是否提交或中止，即使超时也不能确定，如果超时后单方面中止或者提交，都可能与协调者发送的请求不一致。

如果这种场景下协调者崩溃了，参与者不知道提交还是中止，原则上参与者可以相互沟通，找出每个参与者是如何投票的，并达成一致，但这并不是2PC协议的一部份。可以完成2PC的唯一方法是等待协调者恢复，这就是为什么协调者必须在向参与者发送提交或中止请求之前，必须将其决定写入磁盘的事务日志，协调者恢复后，通过读取其事务日志来确定所有存疑事务的状态。

# 三阶段提交
2PC被称为阻塞-原子提交协议，因为存在2PC可能卡住并等待协调者恢复的情况。
理论上，可以使一个原子提交协议变得非阻塞的，3PC假定网络延迟有界、节点响应时间有限，但实际系统却是无限网络延迟和进程暂停的，它并不能保证原子性。
通常，非阻塞提交需要一个完美的故障检测器，即一个可靠的机制来判断一个节点是否崩溃。在具有无限延迟的网络中，超时并不是一种可靠的故障检测机制。
所以2PC仍然被使用，尽管大家都清楚可能存在协调者故障的问题。
