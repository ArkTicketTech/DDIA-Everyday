## Chap9 Consistency and Consensus
分布式系统中处理故障的两种方法：
* 让整个服务停下来，并向用户提示错误信息。
* 如果不能接受服务中止，可以设计更加容错的解决方法，以应对在系统内部组件发生故障时，也可以对外提供服务。

本章假设第 8 章中的所有故障都有可能发生，网络数据包可能丢失、顺序紊乱、重复发送或者延迟，时钟存在偏差，节点可能发生暂停（受机器 gc 影响）或者崩溃。

为了建立容错系统，需要先建立一套通用的抽象机制和与之对应的技术保证，根据这套机制，其上的各种应用程序都可以安全的依赖底层的机制。例如数据库中的事务提供的 ACID，可以使应用层不用考虑复杂问题。

公式：所有节点就某一项提议达成一致。例如，主从复制的数据库进行主节点选举。

本章内容：
1. 讨论分布式系统可提供的若干保证和抽象机制。
2. 分布式系统的边界能力。在何种情况下系统可以容忍错误并继续保持工作；在何种情况下无法保证正常工作。


### Consistency Guarantees
大多数多副本的数据库至少都提供了最终一致性，最终一致性意味着收敛，即预期所有的副本最终都会收敛到相同的值。

但是，该一致性保证比较弱，其无法告知系统将在何时收敛。在收敛之前，读请求可能返回任何值或者失败。例如，对某个值进行更新操作，不同的客户端可能读到多个不同的值，因为可能读到不同的副本。

最终一致性给上层应用开发者的带来的问题处理挑战较大，处理应用的极端错误较难。

本章探索更强的一致性模型，更强的一致性模型意味着付出更大的代价，但好处是让上层应用逻辑更加简单，更不容易出错。

分布式一致性模型和事务隔离级别相似，区别如下：
* 事务隔离主要是为了处理并发事务时的各种临界条件。
* 分布式一致性则主要是针对延迟和故障来协调副本之间的状态。

本章探索问题：
* 线性化一致性模型
* 分布式系统中的事件顺序问题
* 分布式事务与共识